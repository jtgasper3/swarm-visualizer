<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Docker Swarm Services Monitor</title>
</head>
<body>
    <h1>Docker Swarm Monitor</h1>
    <ul id="nodes"></ul>
    <ul id="services"></ul>
    <ul id="tasks"></ul>

    <script type="text/javascript">
        var ws = new WebSocket('ws://' + window.location.host + '/ws');

        ws.onopen = function() {
            console.log('WebSocket connection established');
        };

        ws.onmessage = function(event) {
            console.log(event.data)
            var data = JSON.parse(event.data);
            
            var servicesList = document.getElementById('services');
            servicesList.innerHTML = ''; // Clear the list

            data.services.forEach(function(service) {
                var listItem = document.createElement('li');
                listItem.textContent = service.Spec.Name + ' (' + service.ID + ', Mode: ' + (service.Spec.Mode.Replicated ? 'Replicated' : 'Global') + ')';
                servicesList.appendChild(listItem);
            });

            var nodesList = document.getElementById('nodes');
            nodesList.innerHTML = ''; // Clear the list

            data.nodes.forEach(function(node) {
                var listItem = document.createElement('li');
                listItem.textContent = node.Description.Hostname + ' (' + node.ID + ' Role: ' + (node.Spec.Role) + ')';
                nodesList.appendChild(listItem);
            });

            var tasksList = document.getElementById('tasks');
            tasksList.innerHTML = ''; // Clear the list

            data.tasks.forEach(function(task) {
                var listItem = document.createElement('li');
                listItem.textContent = task.ID + ' (Node: ' + (task.NodeID) + ', Service: ' + (task.ServiceID) + ')';
                tasksList.appendChild(listItem);
            });
        };

        ws.onclose = function() {
            console.log('WebSocket connection closed');
        };

        ws.onerror = function(error) {
            console.error('WebSocket error:', error);
        };
    </script>
</body>
</html>
